<!DOCTYPE html>
<html>
<head>
<title>Memory Love Game PRO</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#ff4f8b,#3b0030);
min-height:100vh;
color:white;
display:flex;
flex-direction:column;
align-items:center;
}

h2{margin:10px;}

.top{text-align:center}

.grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:10px;
width:260px;
margin-top:10px;
}

.card{
width:60px;height:70px;
background:#ffd1dc;
border-radius:10px;
display:flex;
align-items:center;
justify-content:center;
font-size:28px;
cursor:pointer;
transition:.4s;
}

.card.flip{background:white;}

button{
padding:8px 20px;
border-radius:15px;
border:none;
margin:5px;
}

.heart{
position:fixed;
bottom:0;
animation:fly 2s linear;
}

@keyframes fly{
to{transform:translateY(-100vh);opacity:0;}
}

#board{
margin-top:10px;
background:rgba(255,255,255,.2);
padding:10px 15px;
border-radius:15px;
width:260px;
}

.scoreRow{font-size:13px;margin:3px 0;}
</style>
</head>

<body>

<h2>‚ù§Ô∏è Memory Love Game PRO</h2>

<div class="top">
Player: <span id="user"></span><br>
Time: <span id="time">60</span>s |
Moves: <span id="moves">0</span><br>
Score: <span id="score">0</span><br>
<button onclick="restart()">Restart</button>
</div>

<div class="grid" id="grid"></div>

<div id="board">
<b>üèÜ Leaderboard</b>
<div id="leaders"></div>
</div>

<audio id="flip" src="https://assets.mixkit.co/sfx/preview/mixkit-click-error-1110.mp3"></audio>
<audio id="match" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAetysNyLP1kFZIWM-IhDtHH_Kq7HoSGxg",
authDomain:"vmlove-a2df1.firebaseapp.com",
databaseURL:"https://vmlove-a2df1-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"vmlove-a2df1",
storageBucket:"vmlove-a2df1.firebasestorage.app",
messagingSenderId:"932908158778",
appId:"1:932908158778:web:eb8185babb63b8aff80a03"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const scoreRef=ref(db,"scores");

if(!localStorage.user){
localStorage.user=prompt("Enter your name / number");
}
user.innerHTML=localStorage.user;

/* cards */
const icons=["‚ù§Ô∏è","üíñ","üíï","üòç","üòò","üíò"];
let cards=[...icons,...icons].sort(()=>Math.random()-.5);

let first=null,lock=false;
let matched=0;
let movesCount=0;
let timeLeft=60;
let finalScore=0;

/* timer */
setInterval(()=>{
if(timeLeft>0){
timeLeft--;
time.innerHTML=timeLeft;
}else{
gameOver();
}
},1000);

function draw(){
grid.innerHTML="";
cards.forEach((v,i)=>{
let d=document.createElement("div");
d.className="card";
d.onclick=()=>flipCard(d,v);
grid.appendChild(d);
});
}
draw();

function flipCard(el,val){
if(lock||el.classList.contains("flip")||timeLeft<=0)return;
flip.play();
el.classList.add("flip");
el.innerHTML=val;

if(!first){first={el,val};return;}

movesCount++;
moves.innerHTML=movesCount;

if(first.val==val){
match.play();
matched++;
burst();
first=null;
calcScore();
if(matched==6)gameOver();
}else{
lock=true;
setTimeout(()=>{
el.classList.remove("flip");
first.el.classList.remove("flip");
el.innerHTML="";
first.el.innerHTML="";
first=null;
lock=false;
},600);
}
}

function calcScore(){
finalScore = matched*20 + timeLeft*2 - movesCount;
if(finalScore<0)finalScore=0;
score.innerHTML=finalScore;
}

function gameOver(){
calcScore();
saveScore();
alert("Game Over! Score: "+finalScore);
}

function burst(){
for(let i=0;i<10;i++){
let h=document.createElement("div");
h.className="heart";
h.innerHTML="üíñ";
h.style.left=Math.random()*100+"%";
document.body.appendChild(h);
setTimeout(()=>h.remove(),2000);
}
}

function restart(){location.reload();}

/* save single score */
function saveScore(){
set(ref(db,"scores/"+localStorage.user),{
name:localStorage.user,
score:finalScore
});
}

/* leaderboard */
onValue(scoreRef,snap=>{
let arr=[];
snap.forEach(x=>arr.push(x.val()));
arr.sort((a,b)=>b.score-a.score);
leaders.innerHTML="";
arr.slice(0,5).forEach(p=>{
leaders.innerHTML+=`<div class="scoreRow">${p.name} : ${p.score}</div>`;
});
});

</script>

</body>
</html>
