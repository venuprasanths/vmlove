<!DOCTYPE html>
<html>
<head>
<title>Memory Love Game PRO</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#ff4f8b,#3b0030);
min-height:100vh;
color:white;
display:flex;
flex-direction:column;
align-items:center;
}

h2{margin:10px;}

.grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:10px;
width:260px;
}

.card{
width:60px;height:70px;
background:#ffd1dc;
border-radius:10px;
display:flex;
align-items:center;
justify-content:center;
font-size:28px;
cursor:pointer;
}

.card.flip{background:white;}

button{
padding:8px 20px;
border-radius:15px;
border:none;
margin:5px;
}

#leader{
background:rgba(255,255,255,.2);
padding:10px;
border-radius:15px;
width:260px;
margin-top:10px;
font-size:13px;
}

#timeout{
position:fixed;
inset:0;
background:rgba(0,0,0,.7);
display:none;
justify-content:center;
align-items:center;
z-index:10;
}

#timeout div{
background:white;
color:black;
padding:25px;
border-radius:20px;
text-align:center;
}

</style>
</head>

<body>

<h2>‚ù§Ô∏è Memory Love Game PRO</h2>

Player: <span id="user"></span><br>
‚è± <span id="time">60</span>s | Moves: <span id="moves">0</span><br>
Score: <span id="score">0</span><br>

<button onclick="restart()">Restart</button>

<div class="grid" id="grid"></div>

<div id="leader">
<b>üèÜ Leaderboard</b>
<div id="list"></div>
</div>

<div id="timeout">
<div>
<h3>‚è∞ Time Out</h3>
<p>Your Score: <span id="final"></span></p>
<button onclick="restart()">Play Again</button>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAetysNyLP1kFZIWM-IhDtHH_Kq7HoSGxg",
authDomain:"vmlove-a2df1.firebaseapp.com",
databaseURL:"https://vmlove-a2df1-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"vmlove-a2df1",
storageBucket:"vmlove-a2df1.firebasestorage.app",
messagingSenderId:"932908158778",
appId:"1:932908158778:web:eb8185babb63b8aff80a03"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const scoreRef=ref(db,"scores");

if(!localStorage.user){
localStorage.user=prompt("Enter name / number");
}
user.innerHTML=localStorage.user;

/* cards */
const icons=["‚ù§Ô∏è","üíñ","üòç","üòò","üíï","üíò"];
let cards=[...icons,...icons].sort(()=>Math.random()-.5);

let first=null;
let lock=false;
let matched=0;
let moveCount=0;
let scoreVal=0;
let timeLeft=60;

/* draw */
function draw(){
grid.innerHTML="";
cards.forEach(v=>{
let c=document.createElement("div");
c.className="card";
c.onclick=()=>flip(c,v);
grid.appendChild(c);
});
}
draw();

/* timer */
let timer=setInterval(()=>{
if(timeLeft>0){
timeLeft--;
time.innerHTML=timeLeft;
}else{
clearInterval(timer);
endGame();
}
},1000);

function flip(el,val){
if(lock||el.classList.contains("flip")||timeLeft<=0)return;

el.classList.add("flip");
el.innerHTML=val;

if(!first){first={el,val};return;}

moveCount++;
moves.innerHTML=moveCount;

if(first.val==val){
matched++;
first=null;
calcScore();
if(matched==6)endGame();
}else{
lock=true;
setTimeout(()=>{
el.classList.remove("flip");
first.el.classList.remove("flip");
el.innerHTML="";
first.el.innerHTML="";
first=null;
lock=false;
},600);
}
}

function calcScore(){
scoreVal=matched*25 + timeLeft*2 - moveCount;
if(scoreVal<0)scoreVal=0;
score.innerHTML=scoreVal;
}

function endGame(){
calcScore();
saveScore();
final.innerHTML=scoreVal;
timeout.style.display="flex";
}

/* save single */
function saveScore(){
set(ref(db,"scores/"+localStorage.user),{
name:localStorage.user,
score:scoreVal
});
}

/* leaderboard */
onValue(scoreRef,s=>{
let arr=[];
s.forEach(x=>arr.push(x.val()));
arr.sort((a,b)=>b.score-a.score);
list.innerHTML="";
arr.forEach(p=>{
list.innerHTML+=`${p.name} : ${p.score}<br>`;
});
});

function restart(){location.reload();}

</script>

</body>
</html>
