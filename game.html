<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Love Memory Game Pro ‚ù§Ô∏è</title>

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#ff4f8b,#3b0030);
min-height:100vh;
display:flex;
flex-direction:column;
align-items:center;
color:white;
}

.grid{
display:grid;
grid-template-columns:repeat(4,65px);
gap:8px;
margin-top:10px;
}

.card{
width:65px;height:80px;
background:#ffd1dc;
border-radius:10px;
display:flex;
align-items:center;
justify-content:center;
font-size:28px;
cursor:pointer;
}

.hidden{background:white;}

button{
padding:8px 18px;
border-radius:20px;
border:none;
background:#ffd1dc;
margin-top:6px;
}

#leader{font-size:12px;margin-top:10px}

.heart{
position:fixed;
animation:fly 2s linear;
}

@keyframes fly{
to{transform:translateY(-200px);opacity:0;}
}
</style>
</head>

<body>

<h3>‚ù§Ô∏è Memory Love Game PRO</h3>

<div id="user"></div>
<div id="time"></div>
<div id="score"></div>

<button onclick="restart()">Restart</button>

<div class="grid" id="grid"></div>

<div id="leader"></div>

<audio id="match" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3b1a0efdf3.mp3"></audio>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAetysNyLP1kFZIWM-IhDtHH_Kq7HoSGxg",
authDomain:"vmlove-a2df1.firebaseapp.com",
databaseURL:"https://vmlove-a2df1-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"vmlove-a2df1"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const scoreRef=ref(db,"scores");

if(!localStorage.user) location.href="login.html";

user.innerHTML="Player: "+localStorage.user;

const icons=["üíñ","üíç","üåπ","üòò","‚ù§Ô∏è","üòç","üíï","üíã"]; // HARD LEVEL

let cards=[...icons,...icons].sort(()=>0.5-Math.random());
let first=null,lock=false,points=0,time=60;

function start(){
grid.innerHTML="";
cards.sort(()=>0.5-Math.random());
points=0;time=60;
update();

cards.forEach(v=>{
let d=document.createElement("div");
d.className="card hidden";
d.dataset.val=v;
d.onclick=()=>flip(d);
grid.appendChild(d);
});
}

start();

/* TIMER */
setInterval(()=>{
time--;
timeDiv();
if(time<=0){
alert("‚è∞ Time up!");
saveScore();
restart();
}
},1000);

function timeDiv(){time.innerHTML="Time: "+time;}
function update(){score.innerHTML="Score: "+points;timeDiv();}

/* FLIP */
function flip(c){
if(lock||!c.classList.contains("hidden"))return;

c.classList.remove("hidden");
c.innerHTML=c.dataset.val;

if(!first){first=c;return;}

if(first.dataset.val==c.dataset.val){
points++;
match.play();
burst();
first=null;
update();
}else{
lock=true;
setTimeout(()=>{
first.innerHTML="";
c.innerHTML="";
first.classList.add("hidden");
c.classList.add("hidden");
first=null;
lock=false;
},600);
}
}

/* restart */
window.restart=()=>start();

/* hearts */
function burst(){
for(let i=0;i<8;i++){
let h=document.createElement("div");
h.className="heart";
h.innerHTML="üíñ";
h.style.left=Math.random()*100+"%";
h.style.bottom="0";
document.body.appendChild(h);
setTimeout(()=>h.remove(),2000);
}
}

/* SAVE ONLINE SCORE */
function saveScore(){
push(scoreRef,{
name:localStorage.user,
score:points
});
}

/* ONLINE LEADERBOARD */
onValue(scoreRef,snap=>{
let arr=[];
snap.forEach(x=>arr.push(x.val()));
arr.sort((a,b)=>b.score-a.score);
arr=arr.slice(0,5);
leader.innerHTML="<b>üèÜ Online Leaderboard</b><br>"+
arr.map(x=>x.name+" : "+x.score).join("<br>");
});

</script>

</body>
</html>
