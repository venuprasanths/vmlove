<!DOCTYPE html>
<html>
<head>
<title>Love Wall üíå</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
margin:0;font-family:Segoe UI;
background:linear-gradient(135deg,#ff4f8b,#3b0030);
min-height:100vh;color:white;padding:15px;
}

.card{background:rgba(255,255,255,.2);padding:15px;border-radius:20px;max-width:400px;margin:auto;}

input,textarea{width:100%;padding:8px;border-radius:10px;border:none;margin-top:6px;}
button{width:100%;padding:10px;margin-top:8px;border:none;border-radius:15px;background:#ffd1dc;}

.msg{background:white;color:black;padding:8px;border-radius:10px;margin-top:6px;font-size:13px;}
.time{font-size:10px;color:gray;}

.actions span{font-size:12px;margin-right:10px;cursor:pointer;}

.replybox{margin-top:5px;}
.reply{font-size:11px;background:#ffe6f0;padding:4px;border-radius:6px;margin-top:3px;}

.avatar{width:30px;height:30px;border-radius:50%;float:left;margin-right:6px;}
</style>
</head>

<body>

<h3 align=center>üíå Love Wall</h3>

<div class="card">

<input id="uname" placeholder="Your name">
<textarea id="umsg" placeholder="Message"></textarea>
<button onclick="sendMsg()">Send ‚ù§Ô∏è</button>

<div id="messages"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyAetysNyLP1kFZIWM-IhDtHH_Kq7HoSGxg",
databaseURL:"https://vmlove-a2df1-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const wall=ref(db,"wall");

/* SEND MESSAGE */
window.sendMsg=function(){
if(!uname.value||!umsg.value)return alert("Fill both");

push(wall,{
name:uname.value,
msg:umsg.value,
time:new Date().toLocaleString(),
likes:0,
replies:{}
});

umsg.value="";
}

/* SHOW LIVE */
onValue(wall,snap=>{
messages.innerHTML="";
snap.forEach(s=>{
let d=s.val(); let id=s.key;

let liked=localStorage.getItem("like_"+id);

let html=`<div class="msg">
<b>${d.name}</b><br>${d.msg}
<div class="time">${d.time}</div>

<div class="actions">
<span onclick="likeMsg('${id}',${d.likes||0})">${liked?"‚ù§Ô∏è":"ü§ç"} ${d.likes||0}</span>
<span onclick="showReply('${id}')">üí¨ Reply</span>
</div>

<div id="rep_${id}" class="replybox" style="display:none">
<input id="rname_${id}" placeholder="Name">
<input id="rmsg_${id}" placeholder="Reply">
<button onclick="sendReply('${id}')">Reply</button>
</div>`;

if(d.replies){
Object.values(d.replies).forEach(r=>{
html+=`<div class="reply">‚Ü≥ <b>${r.name}</b>: ${r.msg}</div>`;
});
}

html+="</div>";
messages.innerHTML=html+messages.innerHTML;
});
});

/* LIKE ‚Äì only once */
window.likeMsg=function(id,c){
if(localStorage.getItem("like_"+id))return alert("Already liked ‚ù§Ô∏è");
localStorage.setItem("like_"+id,"1");
update(ref(db,"wall/"+id),{likes:c+1});
}

/* REPLY TOGGLE */
window.showReply=function(id){
let x=document.getElementById("rep_"+id);
x.style.display=x.style.display=="none"?"block":"none";
}

/* SEND REPLY */
window.sendReply=function(id){
let n=document.getElementById("rname_"+id).value;
let m=document.getElementById("rmsg_"+id).value;
if(!n||!m)return;

push(ref(db,"wall/"+id+"/replies"),{name:n,msg:m});
}

</script>

</body>
</html>
